\ProvidesPackage{secctex}

\RequirePackage{mathpartir}
\RequirePackage{todonotes}
\RequirePackage{unlist}
\RequirePackage{letltxmacro}
\RequirePackage{bookmark}

\RequirePackage{latexsym,amsmath,amssymb}
\RequirePackage{stmaryrd}
%% stmry doesn't have a bold defined, so define bold to be normal
\SetSymbolFont{stmry}{bold}{U}{stmry}{m}{n}

\RequirePackage{amsbsy}
\RequirePackage{upgreek}
\RequirePackage{url}
\RequirePackage{mathrsfs}

\RequirePackage{amsthm}

% ACM recommended packages
\RequirePackage{microtype}
\RequirePackage[utf8]{inputenc}
\RequirePackage[T1]{fontenc}

%% Automagic title case

\RequirePackage{titlecaps}
\Addlcwords{for a is but and with of in as the etc on to if}

% TODO I'd rather like to hide these internal things, but I guess I'll
% settle for making them internal
\makeatletter
\LetLtxMacro{\@title}{\title}
\LetLtxMacro{\@section}{\section}
\LetLtxMacro{\@subsection}{\subsection}
\LetLtxMacro{\@subsubsection}{\subsubsection}

\newcommand{\@titlecrafter}[3]{
  \if\relax\detokenize{#2}\relax
  #1[#3]{\titlecap{#3}}
  \else
  #1[#2]{\titlecap{#3}}
  \fi
}

\renewcommand{\title}[2][]{
  \@titlecrafter{\@title}{#1}{#2}
}

\renewcommand{\section}[2][]{
  \@titlecrafter{\@section}{#1}{#2}
}
\renewcommand{\subsection}[2][]{
  \@titlecrafter{\@subsection}{#1}{#2}
}
\renewcommand{\subsubsection}[2][]{
  \@titlecrafter{\@subsubsection}{#1}{#2}
}

%% omitthis
\newcommand{\omitthis}[1]{#1}
\DeclareOption{omit}{
  \renewcommand{\omitthis}[1]{}
}

%% todo
\LetLtxMacro{\@todo}{\todo}

\renewcommand{\todo}[2][]{\omitthis{\@todo[#1]{#2}}}

\DeclareOption{todo}{
  \renewcommand{\todo}[2][]{\@todo[#1]{#2}}
}

%% ACM/SIGPLAN format
\newif\ifsecc@sigplan
\secc@sigplantrue

\DeclareOption{nosigplan}{\secc@sigplanfalse}

%% balance the last page?
\newif\ifsecc@balance
\secc@balancefalse

\DeclareOption{balance}{\secc@balancetrue}

%% techrpt or paper?
\newif\ifsecc@techrpt
\secc@techrptfalse

\DeclareOption{techrpt}{\secc@techrpttrue}
\DeclareOption{paper}{\secc@techrptfalse}

\ProcessOptions\relax

\ifsecc@sigplan
  \RequirePackage{natbib}
  \bibpunct{[}{]}{,}{n}{}{,}
  \let\cite=\citep
\fi

\ifsecc@balance
  \RequirePackage{flushend}
\fi

\ifsecc@techrpt
  \RequirePackage{fullpage}
  \renewcommand{\baselinestretch}{1.0}
\else
  \ifsecc@sigplan
  \renewcommand{\bibsection}{
    \section*{\refname\@mkboth{\MakeUppercase{\refname}}{\MakeUppercase{\refname}}}
  }
  \fi
\fi
\makeatother

\input{defs}
\endinput
